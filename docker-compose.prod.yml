services:
  app:
    image: brandonsoccer22/evolnow-app:latest
    container_name: evolnow-app
    restart: unless-stopped
    user: "www-data"
    volumes:
      - /srv/evolnow/app/.env:/var/www/html/.env:ro
      - /srv/evolnow/app/storage/logs:/var/www/html/storage/logs
    expose:
      - "9000"
    depends_on:
      - valkey
      - typesense

  nginx:
    image: nginx:stable-alpine
    container_name: evolnow-nginx
    restart: unless-stopped
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - /srv/evolnow/nginx/evolnow.conf:/etc/nginx/conf.d/default.conf:ro
      - /etc/letsencrypt:/etc/letsencrypt:ro

  valkey:
    image: valkey/valkey:alpine
    container_name: evolnow-valkey
    restart: unless-stopped
    ports:
      - "127.0.0.1:6379:6379"
    volumes:
      - valkey_data:/data

  typesense:
    image: typesense/typesense:0.25.2
    container_name: evolnow-typesense
    restart: unless-stopped
    command: "--data-dir /data --api-key=masterKey --listen-port 8108 --enable-cors"
    ports:
      - "127.0.0.1:8108:8108"
    volumes:
      - typesense_data:/data

volumes:
  typesense_data:
  valkey_data:
